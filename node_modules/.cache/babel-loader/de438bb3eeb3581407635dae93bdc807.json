{"ast":null,"code":"var _jsxFileName = \"/Users/shanengupta/Desktop/react-ocr/src/components/FileUpload.js\";\nimport React, { useContext, useState } from \"react\";\nimport { Upload, message } from \"antd\";\nimport UploadedImages from \"../contexts/UploadedImages\";\nimport useAxios from \"../hooks/useAxios\";\nimport useUrlBuilder from \"../hooks/useUrlBuilder\";\nimport { SearchBar } from \"../components/SearchBar\";\nimport { VideoList } from \"../components/VideoList\";\nimport { VideoDetail } from \"../components/VideoDetail\";\nimport youtube, { KEY } from \"../api/youtube\";\nimport FirebaseContext from \"../firebase/context\";\nimport { vision } from \"../env\";\nimport axios from \"axios\";\nimport { withRouter, NavLink } from \"react-router-dom\";\nconst {\n  Dragger\n} = Upload;\n\nfunction FileUpload() {\n  const uploaded = useContext(UploadedImages);\n  const {\n    loading,\n    setUploadedImages\n  } = uploaded;\n  const [tesText, settesText] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [links, setLinks] = useState([]);\n  const [realloading, setLoading] = useState(true);\n  const [docTitle, setdocTitle] = useState(\"\");\n  const [videos, setVideos] = useState([]);\n  const [selectedVideo, setSelectedVideo] = useState(null);\n  const {\n    firebase\n  } = React.useContext(FirebaseContext);\n\n  function handleSubmit() {\n    const newTitle = messages[1].item;\n    setdocTitle(\"Id\" + newTitle);\n    const newLink = {\n      messages,\n      newTitle: \"Id\" + newTitle\n    };\n    console.log(newTitle);\n    firebase.db.collection(\"syllabus\").doc(\"Id\" + newTitle).set(newLink);\n    console.log(newLink); //firebase.db.collection(\"links\").add(newLink);\n    //const voteRef = firebase.db.collection(\"category\").doc(sub);\n\n    /*    voteRef.get().then(doc => {\n      if (doc.exists) {\n         const prevNum = doc.data().numPosts;\n        let newNum = prevNum + 1;\n        console.log(doc.data().numPosts);\n        firebase.db\n          .collection(\"category\")\n          .doc(sub)\n          .set(\n            {\n              numPosts: newNum\n            },\n            { merge: true }\n          ); \n      }*/\n  }\n\n  const onSearchSubmit = async searchTerm => {\n    const response = await youtube.get(\"/search\", {\n      params: {\n        q: searchTerm,\n        part: \"snippet\",\n        maxResults: 1,\n        key: KEY\n      }\n    });\n    const responseArr = response.data.items;\n    const firstVideo = responseArr[0].id.kind !== \"youtube#channel\" ? responseArr[0] : responseArr[1];\n    setVideos(responseArr);\n    setSelectedVideo(firstVideo);\n    return responseArr;\n  };\n\n  const [ocrState, ocrSend] = useAxios({\n    url: `images:annotate`,\n    method: \"POST\"\n  });\n\n  const fetchLinks = (endpoint, item) => {\n    let searchArr = [];\n    fetch(endpoint).then(function (response) {\n      return response.json();\n    }) // convert to plain text\n    .then(function (text) {\n      const testItem = onSearchSubmit(item);\n      let searchItem;\n      testItem.then(val => {\n        searchItem = {\n          val,\n          item,\n          text\n        }; //console.log(searchItem);\n        // searchArr.push(searchItem);\n        // console.log(searchArr);\n\n        setMessages(oldArray => [...oldArray, searchItem]);\n      });\n    });\n  };\n\n  const endpoint = \"https://vision.googleapis.com/v1/images:annotate\";\n  const searchEndpoint = \"https://reddit-scraper.tailgateishan.vercel.app/search/\";\n\n  const preFormat = arr => {\n    return [arr[0].x, arr[0].y, arr[1].x - arr[0].x, arr[3].y - arr[0].y];\n  };\n\n  const tidyResults = raw => {\n    let results = {\n      texts: [],\n      boundings: []\n    };\n    raw.map((item, index) => {\n      if (index > 0) {\n        results.texts.push(item.description);\n        results.boundings.push(preFormat(item.boundingPoly.vertices));\n      }\n    });\n    return results;\n  };\n\n  const messageKey = \"loadingMsg\";\n\n  const onLoading = () => {\n    message.loading({\n      content: \"Analyzing image..\",\n      duration: 0,\n      key: messageKey\n    });\n  };\n\n  const props = {\n    name: \"file\",\n    multiple: false,\n    accept: \".png,.jpeg,.jpg\",\n    showUploadList: false,\n    disabled: loading,\n    beforeUpload: file => {\n      onLoading(true); // onLoading(false)\n\n      setUploadedImages({\n        loading: true\n      });\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        const base64 = e.target.result.toString().replace(/^data:(.*,)?/, \"\");\n        ocrSend({\n          url: endpoint,\n          params: {\n            key: vision.api_key\n          },\n          data: {\n            requests: [{\n              image: {\n                content: base64\n              },\n              features: [{\n                type: \"DOCUMENT_TEXT_DETECTION\"\n              }]\n            }]\n          }\n        }, res => {\n          const searchVal = res.responses[0].fullTextAnnotation.text.split(/\\s*[\\r\\n]+\\s*/g);\n          settesText(searchVal);\n          searchVal.map((item, index) => {\n            if (item == \"\") {\n              item = \"none\";\n            }\n\n            fetchLinks(`${searchEndpoint}${item}`, item);\n          });\n          setUploadedImages({\n            loading: false,\n            base64,\n            ocrResultsRaw: res.responses[0],\n            ocrResults: tidyResults(res.responses[0].textAnnotations),\n            createdAt: new Date()\n          });\n          console.log(new Date());\n          message.success({\n            content: `action done successfully.`,\n            key: messageKey\n          });\n        }, e => {\n          console.log(e);\n          setUploadedImages({\n            loading: false\n          });\n          message.error({\n            content: `Ops, Something wrong`,\n            key: messageKey\n          });\n        });\n      };\n\n      reader.readAsDataURL(file); // Prevent upload\n\n      return false;\n    } // action: 'https://www.mocky.io/v2/5cc8019d300000980a055e76',\n    // onChange(info) {\n    //   const { status } = info.file;\n    //   if (status !== 'uploading') {\n    //     console.log(info.file, info.fileList);\n    //   }\n    //   if (status === 'done') {\n    //     message.success(`${info.file.name} file uploaded successfully.`);\n    //   } else if (status === 'error') {\n    //     message.error(`${info.file.name} file upload failed.`);\n    //   }\n    // },\n\n  };\n  let submitButton;\n\n  if (videos.length > 0) {\n    submitButton = /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flex__column\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"button cda-remove\",\n      onClick: handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }\n    }, \"Submit\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(NavLink, {\n      to: \"/syllabus\",\n      className: \"frame__demos header-margin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 11\n      }\n    }, \"Go to syllabi\")));\n  } else {\n    submitButton = /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 20\n      }\n    }, \"No syllabus entered\");\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex__column__center full__width\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Dragger, Object.assign({}, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"ant-upload-drag-icon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }\n  }, \"Inbox\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"ant-upload-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 9\n    }\n  }, \"Click or drag image to this area to start analyze\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"ant-upload-hint\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 9\n    }\n  }, \"Only accept jpeg,jpg and png files.\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"five wide column\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 7\n    }\n  }, tesText), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form__margin toggle__button\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }\n  }, submitButton));\n}\n\nexport default FileUpload;","map":{"version":3,"sources":["/Users/shanengupta/Desktop/react-ocr/src/components/FileUpload.js"],"names":["React","useContext","useState","Upload","message","UploadedImages","useAxios","useUrlBuilder","SearchBar","VideoList","VideoDetail","youtube","KEY","FirebaseContext","vision","axios","withRouter","NavLink","Dragger","FileUpload","uploaded","loading","setUploadedImages","tesText","settesText","messages","setMessages","links","setLinks","realloading","setLoading","docTitle","setdocTitle","videos","setVideos","selectedVideo","setSelectedVideo","firebase","handleSubmit","newTitle","item","newLink","console","log","db","collection","doc","set","onSearchSubmit","searchTerm","response","get","params","q","part","maxResults","key","responseArr","data","items","firstVideo","id","kind","ocrState","ocrSend","url","method","fetchLinks","endpoint","searchArr","fetch","then","json","text","testItem","searchItem","val","oldArray","searchEndpoint","preFormat","arr","x","y","tidyResults","raw","results","texts","boundings","map","index","push","description","boundingPoly","vertices","messageKey","onLoading","content","duration","props","name","multiple","accept","showUploadList","disabled","beforeUpload","file","reader","FileReader","onload","e","base64","target","result","toString","replace","api_key","requests","image","features","type","res","searchVal","responses","fullTextAnnotation","split","ocrResultsRaw","ocrResults","textAnnotations","createdAt","Date","success","error","readAsDataURL","submitButton","length"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\nimport { Upload, message } from \"antd\";\nimport UploadedImages from \"../contexts/UploadedImages\";\nimport useAxios from \"../hooks/useAxios\";\nimport useUrlBuilder from \"../hooks/useUrlBuilder\";\nimport { SearchBar } from \"../components/SearchBar\";\nimport { VideoList } from \"../components/VideoList\";\nimport { VideoDetail } from \"../components/VideoDetail\";\nimport youtube, { KEY } from \"../api/youtube\";\nimport FirebaseContext from \"../firebase/context\";\nimport { vision } from \"../env\";\nimport axios from \"axios\";\nimport { withRouter, NavLink } from \"react-router-dom\";\n\nconst { Dragger } = Upload;\n\nfunction FileUpload() {\n  const uploaded = useContext(UploadedImages);\n  const { loading, setUploadedImages } = uploaded;\n  const [tesText, settesText] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [links, setLinks] = useState([]);\n  const [realloading, setLoading] = useState(true);\n  const [docTitle, setdocTitle] = useState(\"\");\n  const [videos, setVideos] = useState([]);\n  const [selectedVideo, setSelectedVideo] = useState(null);\n  const { firebase } = React.useContext(FirebaseContext);\n\n  function handleSubmit() {\n    const newTitle = messages[1].item;\n    setdocTitle(\"Id\" + newTitle);\n    const newLink = {\n      messages,\n      newTitle: \"Id\" + newTitle\n    };\n    console.log(newTitle);\n    firebase.db\n      .collection(\"syllabus\")\n      .doc(\"Id\" + newTitle)\n      .set(newLink);\n    console.log(newLink);\n    //firebase.db.collection(\"links\").add(newLink);\n    //const voteRef = firebase.db.collection(\"category\").doc(sub);\n    /*    voteRef.get().then(doc => {\n      if (doc.exists) {\n         const prevNum = doc.data().numPosts;\n        let newNum = prevNum + 1;\n        console.log(doc.data().numPosts);\n        firebase.db\n          .collection(\"category\")\n          .doc(sub)\n          .set(\n            {\n              numPosts: newNum\n            },\n            { merge: true }\n          ); \n      }*/\n  }\n\n  const onSearchSubmit = async searchTerm => {\n    const response = await youtube.get(\"/search\", {\n      params: {\n        q: searchTerm,\n        part: \"snippet\",\n        maxResults: 1,\n        key: KEY\n      }\n    });\n    const responseArr = response.data.items;\n    const firstVideo =\n      responseArr[0].id.kind !== \"youtube#channel\"\n        ? responseArr[0]\n        : responseArr[1];\n    setVideos(responseArr);\n    setSelectedVideo(firstVideo);\n    return responseArr;\n  };\n  const [ocrState, ocrSend] = useAxios({\n    url: `images:annotate`,\n    method: \"POST\"\n  });\n\n  const fetchLinks = (endpoint, item) => {\n    let searchArr = [];\n    fetch(endpoint)\n      .then(function(response) {\n        return response.json();\n      }) // convert to plain text\n      .then(function(text) {\n        const testItem = onSearchSubmit(item);\n        let searchItem;\n        testItem.then(val => {\n          searchItem = {\n            val,\n            item,\n            text\n          };\n          //console.log(searchItem);\n          // searchArr.push(searchItem);\n          // console.log(searchArr);\n\n          setMessages(oldArray => [...oldArray, searchItem]);\n        });\n      });\n  };\n\n  const endpoint = \"https://vision.googleapis.com/v1/images:annotate\";\n  const searchEndpoint =\n    \"https://reddit-scraper.tailgateishan.vercel.app/search/\";\n  const preFormat = arr => {\n    return [arr[0].x, arr[0].y, arr[1].x - arr[0].x, arr[3].y - arr[0].y];\n  };\n\n  const tidyResults = raw => {\n    let results = {\n      texts: [],\n      boundings: []\n    };\n    raw.map((item, index) => {\n      if (index > 0) {\n        results.texts.push(item.description);\n        results.boundings.push(preFormat(item.boundingPoly.vertices));\n      }\n    });\n    return results;\n  };\n\n  const messageKey = \"loadingMsg\";\n\n  const onLoading = () => {\n    message.loading({\n      content: \"Analyzing image..\",\n      duration: 0,\n      key: messageKey\n    });\n  };\n\n  const props = {\n    name: \"file\",\n    multiple: false,\n    accept: \".png,.jpeg,.jpg\",\n    showUploadList: false,\n    disabled: loading,\n    beforeUpload: file => {\n      onLoading(true);\n      // onLoading(false)\n\n      setUploadedImages({\n        loading: true\n      });\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        const base64 = e.target.result.toString().replace(/^data:(.*,)?/, \"\");\n        ocrSend(\n          {\n            url: endpoint,\n            params: {\n              key: vision.api_key\n            },\n            data: {\n              requests: [\n                {\n                  image: {\n                    content: base64\n                  },\n                  features: [\n                    {\n                      type: \"DOCUMENT_TEXT_DETECTION\"\n                    }\n                  ]\n                }\n              ]\n            }\n          },\n          res => {\n            const searchVal = res.responses[0].fullTextAnnotation.text.split(\n              /\\s*[\\r\\n]+\\s*/g\n            );\n\n            settesText(searchVal);\n\n            searchVal.map((item, index) => {\n              if (item == \"\") {\n                item = \"none\";\n              }\n\n              fetchLinks(`${searchEndpoint}${item}`, item);\n            });\n\n            setUploadedImages({\n              loading: false,\n              base64,\n              ocrResultsRaw: res.responses[0],\n              ocrResults: tidyResults(res.responses[0].textAnnotations),\n              createdAt: new Date()\n            });\n            console.log(new Date());\n            message.success({\n              content: `action done successfully.`,\n              key: messageKey\n            });\n          },\n          e => {\n            console.log(e);\n            setUploadedImages({\n              loading: false\n            });\n            message.error({\n              content: `Ops, Something wrong`,\n              key: messageKey\n            });\n          }\n        );\n      };\n      reader.readAsDataURL(file);\n\n      // Prevent upload\n      return false;\n    }\n    // action: 'https://www.mocky.io/v2/5cc8019d300000980a055e76',\n    // onChange(info) {\n    //   const { status } = info.file;\n    //   if (status !== 'uploading') {\n    //     console.log(info.file, info.fileList);\n    //   }\n    //   if (status === 'done') {\n    //     message.success(`${info.file.name} file uploaded successfully.`);\n    //   } else if (status === 'error') {\n    //     message.error(`${info.file.name} file upload failed.`);\n    //   }\n    // },\n  };\n  let submitButton;\n  if (videos.length > 0) {\n    submitButton = (\n      <div className=\"flex__column\">\n        <button className=\"button cda-remove\" onClick={handleSubmit}>\n          Submit\n        </button>\n        <div>\n          <NavLink to=\"/syllabus\" className=\"frame__demos header-margin\">\n            Go to syllabi\n          </NavLink>\n        </div>\n      </div>\n    );\n  } else {\n    submitButton = <div>No syllabus entered</div>;\n  }\n\n  return (\n    <div className=\"flex__column__center full__width\">\n      <Dragger {...props}>\n        <p className=\"ant-upload-drag-icon\">Inbox</p>\n        <p className=\"ant-upload-text\">\n          Click or drag image to this area to start analyze\n        </p>\n\n        <p className=\"ant-upload-hint\">Only accept jpeg,jpg and png files.</p>\n      </Dragger>\n      <div className=\"five wide column\">{tesText}</div>\n\n      <div className=\"form__margin toggle__button\">{submitButton}</div>\n    </div>\n  );\n}\n\nexport default FileUpload;\n"]},"metadata":{},"sourceType":"module"}