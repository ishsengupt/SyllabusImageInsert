{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _seedrandom = require('seedrandom');\n\nvar _seedrandom2 = _interopRequireDefault(_seedrandom);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar Boundingbox = function (_Component) {\n  (0, _inherits3.default)(Boundingbox, _Component);\n\n  function Boundingbox(props) {\n    (0, _classCallCheck3.default)(this, Boundingbox);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Boundingbox.__proto__ || (0, _getPrototypeOf2.default)(Boundingbox)).call(this, props));\n\n    _this.state = {\n      canvasCreated: false,\n      hoverIndex: -1,\n      segmentColors: []\n    };\n\n    if (props.segmentationJsonUrl) {\n      fetch(props.segmentationJsonUrl).then(function (response) {\n        return response.json();\n      }).then(function (response) {\n        if (response.body && response.body.predictions && response.body.predictions[0] && response.body.predictions[0].vals && response.body.predictions[0].vals.length > 0) {\n          _this.setState({\n            isSegmented: false\n          });\n\n          _this.renderSegmentation(response.body.predictions[0].vals);\n        }\n      });\n    }\n\n    return _this;\n  }\n\n  (0, _createClass3.default)(Boundingbox, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var ctx = this.canvas.getContext('2d');\n      var background = new Image();\n      background.src = this.props.options.base64Image ? 'data:image/png;base64,' + this.props.image : this.props.image; // Make sure the image is loaded first otherwise nothing will draw.\n\n      background.onload = function () {\n        _this2.canvas.width = background.width;\n        _this2.canvas.height = background.height;\n        ctx.drawImage(background, 0, 0);\n\n        _this2.renderBoxes();\n\n        var hasSegmentedState = _this2.state.pixelSegmentation && _this2.state.pixelSegmentation.length > 0 && !_this2.state.isSegmented;\n        var hasSegmentedProps = _this2.props.pixelSegmentation && _this2.props.pixelSegmentation.length > 0 && !_this2.state.isSegmented;\n        var hasSegmentionMasks = _this2.props.segmentationMasks && _this2.props.segmentationMasks.length > 0 && !_this2.state.isSegmented;\n        if (hasSegmentedState) _this2.renderSegmentation(_this2.state.pixelSegmentation);\n        if (hasSegmentedProps) _this2.renderSegmentation(_this2.props.pixelSegmentation);\n        if (hasSegmentionMasks) _this2.renderSegmentationMasks();\n\n        _this2.canvas.onmousemove = function (e) {\n          // Get the current mouse position\n          var r = _this2.canvas.getBoundingClientRect();\n\n          var scaleX = _this2.canvas.width / r.width;\n          var scaleY = _this2.canvas.height / r.height;\n          var x = (e.clientX - r.left) * scaleX;\n          var y = (e.clientY - r.top) * scaleY; // ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n          var selectedBox = {\n            index: -1,\n            dimensions: null\n          };\n\n          if (_this2.props.boxes && _this2.props.boxes.length > 0) {\n            _this2.props.boxes.forEach(function (box, index) {\n              if (!box || typeof box === 'undefined') return null;\n              var coord = box.coord ? box.coord : box;\n              var bx = 0,\n                  by = 0,\n                  bw = 0,\n                  bh = 0;\n\n              if (typeof coord.xmin !== 'undefined' && typeof coord.xmax !== 'undefined' && typeof coord.ymin !== 'undefined' && typeof coord.ymax !== 'undefined') {\n                var _ref = [coord.xmin, coord.ymax, Math.abs(coord.xmax - coord.xmin), Math.abs(coord.ymax - coord.ymin)]; // coord is an object containing xmin, xmax, ymin, ymax attributes\n                // width is absolute value of (xmax - xmin)\n                // height is absolute value of (ymax - ymin)\n                // absolute value takes care of various possible referentials:\n                //   - sometimes 0,0 is top-left corner\n                //   - sometimes 0,0 is bottom-left corner\n\n                bx = _ref[0];\n                by = _ref[1];\n                bw = _ref[2];\n                bh = _ref[3];\n              } else {\n                var _coord = (0, _slicedToArray3.default)(coord, 4); // coord is an array containing [x, y, width, height] values\n\n\n                bx = _coord[0];\n                by = _coord[1];\n                bw = _coord[2];\n                bh = _coord[3];\n              }\n\n              if (x >= bx && x <= bx + bw && y >= by && y <= by + bh) {\n                // The mouse honestly hits the rect\n                var insideBox = !selectedBox.dimensions || bx >= selectedBox.dimensions[0] && bx <= selectedBox.dimensions[0] + selectedBox.dimensions[2] && by >= selectedBox.dimensions[1] && by <= selectedBox.dimensions[1] + selectedBox.dimensions[3];\n\n                if (insideBox) {\n                  selectedBox.index = index;\n                  selectedBox.dimensions = box;\n                }\n              }\n            });\n          } else if (_this2.state.pixelSegmentation && _this2.state.pixelSegmentation.length > 0) {\n            selectedBox.index = _this2.state.pixelSegmentation[x + _this2.canvas.width * y];\n          }\n\n          _this2.props.onSelected(selectedBox.index);\n\n          _this2.setState({\n            hoverIndex: selectedBox.index\n          });\n        };\n\n        _this2.canvas.onmouseout = function () {\n          _this2.props.onSelected(-1);\n\n          _this2.setState({\n            hoverIndex: -1\n          }); // this.renderBoxes();\n\n        };\n\n        _this2.canvas.addEventListener('click', function (event) {\n          _this2.props.onClicked(_this2.state.hoverIndex);\n        }, false);\n      };\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      var _this3 = this;\n\n      var ctx = this.canvas.getContext('2d');\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      var background = new Image();\n      background.src = nextProps.options.base64Image ? 'data:image/png;base64,' + this.props.image : nextProps.image; // Check canvas dimension with loaded image dimension\n      // in order to change canvas dimension if needed\n\n      background.onload = function () {\n        if (_this3.canvas.width !== background.width && _this3.canvas.height !== background.height) {\n          _this3.canvas.width = background.width;\n          _this3.canvas.height = background.height;\n          ctx.drawImage(background, 0, 0);\n\n          _this3.renderBoxes(nextProps.boxes);\n        }\n      };\n\n      ctx.drawImage(background, 0, 0);\n      this.renderBoxes(nextProps.boxes);\n      this.setState({\n        hoverIndex: nextProps.selectedIndex\n      });\n      var hasSegmentedProps = nextProps.pixelSegmentation && nextProps.pixelSegmentation.length > 0;\n\n      if (hasSegmentedProps) {\n        this.setState({\n          isSegmented: false\n        });\n        this.renderSegmentation(nextProps.pixelSegmentation);\n      }\n\n      return true;\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      this.renderBoxes();\n    }\n  }, {\n    key: 'segmentColor',\n    value: function segmentColor(classIndex) {\n      var segmentColors = this.state.segmentColors;\n\n      if (segmentColors[classIndex] && segmentColors[classIndex].length === 3) {\n        return segmentColors[classIndex];\n      }\n\n      var r = void 0;\n      var g = void 0;\n      var b = void 0;\n\n      if (this.props.segmentationColors && this.props.segmentationColors[classIndex]) {\n        var hex = this.props.segmentationColors[classIndex];\n        var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        r = parseInt(result[1], 16);\n        g = parseInt(result[2], 16);\n        b = parseInt(result[3], 16);\n      } else {\n        var random = (0, _seedrandom2.default)(classIndex);\n        r = Math.floor(random() * 255);\n        g = Math.floor(random() * 255);\n        b = Math.floor(random() * 255);\n      }\n\n      segmentColors[classIndex] = [r, g, b];\n      this.setState({\n        segmentColors: segmentColors\n      });\n      return [r, g, b];\n    }\n  }, {\n    key: 'renderBox',\n    value: function renderBox(box, index) {\n      if (!box || typeof box === 'undefined') return null;\n      var color = this.props.options.colors.normal;\n\n      if (this.state.hoverIndex >= 0) {\n        color = this.props.options.colors.unselected;\n      }\n\n      if (index === this.state.hoverIndex) {\n        color = this.props.options.colors.selected;\n      }\n\n      var lineWidth = 2;\n\n      if (this.canvas.width > 600) {\n        lineWidth = 3;\n      }\n\n      if (this.canvas.width > 1000) {\n        lineWidth = 5;\n      }\n\n      this.props.drawBox(this.canvas, box, color, lineWidth);\n\n      if (box.label) {\n        this.props.drawLabel(this.canvas, box);\n      }\n\n      ;\n    }\n  }, {\n    key: 'renderBoxes',\n    value: function renderBoxes(boxes) {\n      var _this4 = this;\n\n      if (typeof boxes === 'undefined') boxes = this.props.boxes;\n\n      if (this.props.boxes && this.props.boxes.length > 0) {\n        this.props.boxes.map(function (box, index) {\n          var selected = index === _this4.state.hoverIndex;\n          return {\n            box: box,\n            index: index,\n            selected: selected\n          };\n        }).sort(function (a) {\n          return a.selected ? 1 : -1;\n        }).forEach(function (box) {\n          return _this4.renderBox(box.box, box.index);\n        });\n      }\n    }\n  }, {\n    key: 'renderSegmentation',\n    value: function renderSegmentation(segmentation) {\n      var ctx = null;\n      var imgd = null;\n\n      if (this.props.separateSegmentation && this.segCanvas) {\n        this.segCanvas.width = this.canvas.width;\n        this.segCanvas.height = this.canvas.height;\n        ctx = this.segCanvas.getContext('2d');\n        imgd = ctx.getImageData(0, 0, this.segCanvas.width, this.segCanvas.height);\n        var pix = imgd.data;\n\n        for (var i = 0, j = 0, n = pix.length; i < n; i += 4, j += 1) {\n          var segmentClass = segmentation[j];\n          var segmentColor = this.segmentColor(segmentClass);\n          pix[i] = segmentColor[0];\n          pix[i + 1] = segmentColor[1];\n          pix[i + 2] = segmentColor[2];\n          pix[i + 3] = 255;\n        }\n      } else {\n        ctx = this.canvas.getContext('2d');\n        imgd = ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n        var _pix = imgd.data;\n\n        for (var i = 0, j = 0, n = _pix.length; i < n; i += 4, j += 1) {\n          var _segmentClass = segmentation[j];\n\n          var _segmentColor = this.segmentColor(_segmentClass);\n\n          _pix[i] = Math.round((_pix[i] + _segmentColor[0]) / 2);\n          _pix[i + 1] = Math.round((_pix[i + 1] + _segmentColor[1]) / 2);\n          _pix[i + 2] = Math.round((_pix[i + 2] + _segmentColor[2]) / 2);\n          _pix[i + 3] = 200;\n        }\n      }\n\n      ctx.putImageData(imgd, 0, 0);\n      this.setState({\n        isSegmented: true\n      });\n    }\n  }, {\n    key: 'renderSegmentationMasks',\n    value: function renderSegmentationMasks() {\n      var _this5 = this;\n\n      var _props = this.props,\n          boxes = _props.boxes,\n          segmentationMasks = _props.segmentationMasks,\n          segmentationTransparency = _props.segmentationTransparency;\n      this.segCanvas.width = this.canvas.width;\n      this.segCanvas.height = this.canvas.height;\n      var ctx = this.segCanvas.getContext('2d');\n      segmentationMasks.forEach(function (mask, index) {\n        // Fetch segment color,\n        // using box label or current mask index\n        var segmentColor = _this5.segmentColor(boxes[index].label ? boxes[index].label : index); // Fetch image data\n        // using the box coordinates\n        // and the mask dimensions\n\n\n        var maskData = ctx.getImageData(parseInt(boxes[index].xmin, 10), parseInt(boxes[index].ymin, 10), mask.width, mask.height); // Fill image data with new mask color\n\n        for (var i = 0, j = 0; i < maskData.data.length; j++, i += 4) {\n          if (mask.data[j] > 0) {\n            maskData.data[i] = segmentColor[0];\n            maskData.data[i + 1] = segmentColor[1];\n            maskData.data[i + 2] = segmentColor[2];\n            maskData.data[i + 3] = segmentationTransparency;\n          }\n        } // Put new mask data on displayed canvas\n\n\n        ctx.putImageData(maskData, parseInt(boxes[index].xmin, 10), parseInt(boxes[index].ymin, 10), 0, 0, mask.width, mask.height);\n      });\n      this.setState({\n        isSegmented: true\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this6 = this;\n\n      return _react2.default.createElement('div', {\n        className: this.props.className\n      }, _react2.default.createElement('canvas', {\n        className: 'boundingBoxCanvas',\n        style: this.props.options.style,\n        ref: function ref(canvas) {\n          _this6.canvas = canvas;\n        }\n      }), this.props.separateSegmentation ? _react2.default.createElement('canvas', {\n        className: 'boundingSegmentationCanvas',\n        style: this.props.options.style,\n        ref: function ref(canvas) {\n          _this6.segCanvas = canvas;\n        }\n      }) : null);\n    }\n  }]);\n  return Boundingbox;\n}(_react.Component);\n/* global Image */\n\n\nBoundingbox.propTypes = {\n  image: _propTypes2.default.string,\n  boxes: _propTypes2.default.oneOfType([_propTypes2.default.arrayOf(_propTypes2.default.array), _propTypes2.default.arrayOf(_propTypes2.default.object)]),\n  separateSegmentation: _propTypes2.default.bool,\n  segmentationJsonUrl: _propTypes2.default.string,\n  segmentationColors: _propTypes2.default.array,\n  segmentationMasks: _propTypes2.default.array,\n  segmentationTransparency: _propTypes2.default.number,\n  selectedIndex: _propTypes2.default.number,\n  drawBox: _propTypes2.default.func,\n  drawLabel: _propTypes2.default.func,\n  onSelected: _propTypes2.default.func,\n  onClicked: _propTypes2.default.func,\n  options: _propTypes2.default.shape({\n    colors: _propTypes2.default.shape({\n      normal: _propTypes2.default.string,\n      selected: _propTypes2.default.string,\n      unselected: _propTypes2.default.string\n    }),\n    style: _propTypes2.default.object,\n    base64Image: _propTypes2.default.bool\n  })\n};\nBoundingbox.defaultProps = {\n  separateSegmentation: false,\n  segmentationTransparency: 190,\n  onSelected: function onSelected() {},\n  onClicked: function onClicked() {},\n  drawBox: function drawBox(canvas, box, color, lineWidth) {\n    if (!box || typeof box === 'undefined') return null;\n    var ctx = canvas.getContext('2d');\n    var coord = box.coord ? box.coord : box;\n    var x = 0,\n        y = 0,\n        width = 0,\n        height = 0;\n\n    if (typeof coord.xmin !== 'undefined' && typeof coord.xmax !== 'undefined' && typeof coord.ymin !== 'undefined' && typeof coord.ymax !== 'undefined') {\n      var _ref2 = [coord.xmin, coord.ymax, Math.abs(coord.xmax - coord.xmin), Math.abs(coord.ymax - coord.ymin)]; // coord is an object containing xmin, xmax, ymin, ymax attributes\n      // width is absolute value of (xmax - xmin)\n      // height is absolute value of (ymax - ymin)\n      // absolute value takes care of various possible referentials:\n      //   - sometimes 0,0 is top-left corner\n      //   - sometimes 0,0 is bottom-left corner\n\n      x = _ref2[0];\n      y = _ref2[1];\n      width = _ref2[2];\n      height = _ref2[3];\n    } else {\n      var _coord2 = (0, _slicedToArray3.default)(coord, 4); // coord is an array containing [x, y, width, height] values\n\n\n      x = _coord2[0];\n      y = _coord2[1];\n      width = _coord2[2];\n      height = _coord2[3];\n    }\n\n    if (x < lineWidth / 2) {\n      x = lineWidth / 2;\n    }\n\n    if (y < lineWidth / 2) {\n      y = lineWidth / 2;\n    }\n\n    if (x + width > canvas.width) {\n      width = canvas.width - lineWidth - x;\n    }\n\n    if (y + height > canvas.height) {\n      height = canvas.height - lineWidth - y;\n    } // Left segment\n\n\n    var tenPercent = width / 10;\n    var ninetyPercent = 9 * tenPercent;\n    ctx.strokeStyle = color;\n    ctx.lineWidth = lineWidth;\n    ctx.beginPath();\n    ctx.moveTo(x + tenPercent, y);\n    ctx.lineTo(x, y);\n    ctx.lineTo(x, y + height);\n    ctx.lineTo(x + tenPercent, y + height);\n    ctx.stroke(); // Right segment\n\n    ctx.beginPath();\n    ctx.moveTo(x + ninetyPercent, y);\n    ctx.lineTo(x + width, y);\n    ctx.lineTo(x + width, y + height);\n    ctx.lineTo(x + ninetyPercent, y + height);\n    ctx.stroke();\n  },\n  drawLabel: function drawLabel(canvas, box) {\n    if (!box || typeof box === 'undefined') return null;\n    var ctx = canvas.getContext('2d');\n    var coord = box.coord ? box.coord : box;\n    var x = 0,\n        y = 0,\n        width = 0,\n        height = 0;\n\n    if (typeof coord.xmin !== 'undefined' && typeof coord.xmax !== 'undefined' && typeof coord.ymin !== 'undefined' && typeof coord.ymax !== 'undefined') {\n      var _ref3 = [coord.xmin, coord.ymax, Math.abs(coord.xmax - coord.xmin), Math.abs(coord.ymax - coord.ymin)]; // coord is an object containing xmin, xmax, ymin, ymax attributes\n      // width is absolute value of (xmax - xmin)\n      // height is absolute value of (ymax - ymin)\n      // absolute value takes care of various possible referentials:\n      //   - sometimes 0,0 is top-left corner\n      //   - sometimes 0,0 is bottom-left corner\n\n      x = _ref3[0];\n      y = _ref3[1];\n      width = _ref3[2];\n      height = _ref3[3];\n    } else {\n      var _coord3 = (0, _slicedToArray3.default)(coord, 4); // coord is an array containing [x, y, width, height] values\n\n\n      x = _coord3[0];\n      y = _coord3[1];\n      width = _coord3[2];\n      height = _coord3[3];\n    }\n\n    ctx.font = '60px Arial';\n    ctx.fillStyle = 'rgba(225,0,0,1)';\n    ctx.fillText(box.label, x, y + height);\n  },\n  options: {\n    colors: {\n      normal: 'rgba(255,225,255,1)',\n      selected: 'rgba(0,225,204,1)',\n      unselected: 'rgba(100,100,100,1)'\n    },\n    style: {\n      maxWidth: '100%',\n      maxHeight: '90vh'\n    },\n    base64Image: false\n  }\n};\nexports.default = Boundingbox;\nmodule.exports = exports['default'];","map":{"version":3,"sources":["/Users/shanengupta/Desktop/react-ocr/node_modules/react-bbox/dist/react-bounding-box.js"],"names":["Object","defineProperty","exports","value","_slicedToArray2","require","_slicedToArray3","_interopRequireDefault","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_propTypes","_propTypes2","_seedrandom","_seedrandom2","obj","__esModule","default","Boundingbox","_Component","props","_this","__proto__","call","state","canvasCreated","hoverIndex","segmentColors","segmentationJsonUrl","fetch","then","response","json","body","predictions","vals","length","setState","isSegmented","renderSegmentation","key","componentDidMount","_this2","ctx","canvas","getContext","background","Image","src","options","base64Image","image","onload","width","height","drawImage","renderBoxes","hasSegmentedState","pixelSegmentation","hasSegmentedProps","hasSegmentionMasks","segmentationMasks","renderSegmentationMasks","onmousemove","e","r","getBoundingClientRect","scaleX","scaleY","x","clientX","left","y","clientY","top","selectedBox","index","dimensions","boxes","forEach","box","coord","bx","by","bw","bh","xmin","xmax","ymin","ymax","_ref","Math","abs","_coord","insideBox","onSelected","onmouseout","addEventListener","event","onClicked","componentWillReceiveProps","nextProps","_this3","clearRect","selectedIndex","componentDidUpdate","segmentColor","classIndex","g","b","segmentationColors","hex","result","exec","parseInt","random","floor","renderBox","color","colors","normal","unselected","selected","lineWidth","drawBox","label","drawLabel","_this4","map","sort","a","segmentation","imgd","separateSegmentation","segCanvas","getImageData","pix","data","i","j","n","segmentClass","_pix","_segmentClass","_segmentColor","round","putImageData","_this5","_props","segmentationTransparency","mask","maskData","render","_this6","createElement","className","style","ref","Component","propTypes","string","oneOfType","arrayOf","array","object","bool","number","func","shape","defaultProps","_ref2","_coord2","tenPercent","ninetyPercent","strokeStyle","beginPath","moveTo","lineTo","stroke","_ref3","_coord3","font","fillStyle","fillText","maxWidth","maxHeight","module"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _seedrandom = require('seedrandom');\n\nvar _seedrandom2 = _interopRequireDefault(_seedrandom);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Boundingbox = function (_Component) {\n  (0, _inherits3.default)(Boundingbox, _Component);\n\n  function Boundingbox(props) {\n    (0, _classCallCheck3.default)(this, Boundingbox);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Boundingbox.__proto__ || (0, _getPrototypeOf2.default)(Boundingbox)).call(this, props));\n\n    _this.state = {\n      canvasCreated: false,\n      hoverIndex: -1,\n      segmentColors: []\n    };\n\n    if (props.segmentationJsonUrl) {\n      fetch(props.segmentationJsonUrl).then(function (response) {\n        return response.json();\n      }).then(function (response) {\n\n        if (response.body && response.body.predictions && response.body.predictions[0] && response.body.predictions[0].vals && response.body.predictions[0].vals.length > 0) {\n\n          _this.setState({ isSegmented: false });\n          _this.renderSegmentation(response.body.predictions[0].vals);\n        }\n      });\n    }\n    return _this;\n  }\n\n  (0, _createClass3.default)(Boundingbox, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var ctx = this.canvas.getContext('2d');\n\n      var background = new Image();\n      background.src = this.props.options.base64Image ? 'data:image/png;base64,' + this.props.image : this.props.image;\n\n      // Make sure the image is loaded first otherwise nothing will draw.\n      background.onload = function () {\n        _this2.canvas.width = background.width;\n        _this2.canvas.height = background.height;\n\n        ctx.drawImage(background, 0, 0);\n        _this2.renderBoxes();\n\n        var hasSegmentedState = _this2.state.pixelSegmentation && _this2.state.pixelSegmentation.length > 0 && !_this2.state.isSegmented;\n\n        var hasSegmentedProps = _this2.props.pixelSegmentation && _this2.props.pixelSegmentation.length > 0 && !_this2.state.isSegmented;\n\n        var hasSegmentionMasks = _this2.props.segmentationMasks && _this2.props.segmentationMasks.length > 0 && !_this2.state.isSegmented;\n\n        if (hasSegmentedState) _this2.renderSegmentation(_this2.state.pixelSegmentation);\n\n        if (hasSegmentedProps) _this2.renderSegmentation(_this2.props.pixelSegmentation);\n\n        if (hasSegmentionMasks) _this2.renderSegmentationMasks();\n\n        _this2.canvas.onmousemove = function (e) {\n          // Get the current mouse position\n          var r = _this2.canvas.getBoundingClientRect();\n          var scaleX = _this2.canvas.width / r.width;\n          var scaleY = _this2.canvas.height / r.height;\n          var x = (e.clientX - r.left) * scaleX;\n          var y = (e.clientY - r.top) * scaleY;\n\n          // ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n          var selectedBox = { index: -1, dimensions: null };\n\n          if (_this2.props.boxes && _this2.props.boxes.length > 0) {\n\n            _this2.props.boxes.forEach(function (box, index) {\n\n              if (!box || typeof box === 'undefined') return null;\n\n              var coord = box.coord ? box.coord : box;\n\n              var bx = 0,\n                  by = 0,\n                  bw = 0,\n                  bh = 0;\n\n\n              if (typeof coord.xmin !== 'undefined' && typeof coord.xmax !== 'undefined' && typeof coord.ymin !== 'undefined' && typeof coord.ymax !== 'undefined') {\n                var _ref = [coord.xmin, coord.ymax, Math.abs(coord.xmax - coord.xmin), Math.abs(coord.ymax - coord.ymin)];\n\n                // coord is an object containing xmin, xmax, ymin, ymax attributes\n                // width is absolute value of (xmax - xmin)\n                // height is absolute value of (ymax - ymin)\n                // absolute value takes care of various possible referentials:\n                //   - sometimes 0,0 is top-left corner\n                //   - sometimes 0,0 is bottom-left corner\n\n                bx = _ref[0];\n                by = _ref[1];\n                bw = _ref[2];\n                bh = _ref[3];\n              } else {\n                var _coord = (0, _slicedToArray3.default)(coord, 4);\n\n                // coord is an array containing [x, y, width, height] values\n\n\n                bx = _coord[0];\n                by = _coord[1];\n                bw = _coord[2];\n                bh = _coord[3];\n              }\n\n              if (x >= bx && x <= bx + bw && y >= by && y <= by + bh) {\n                // The mouse honestly hits the rect\n                var insideBox = !selectedBox.dimensions || bx >= selectedBox.dimensions[0] && bx <= selectedBox.dimensions[0] + selectedBox.dimensions[2] && by >= selectedBox.dimensions[1] && by <= selectedBox.dimensions[1] + selectedBox.dimensions[3];\n                if (insideBox) {\n                  selectedBox.index = index;\n                  selectedBox.dimensions = box;\n                }\n              }\n            });\n          } else if (_this2.state.pixelSegmentation && _this2.state.pixelSegmentation.length > 0) {\n            selectedBox.index = _this2.state.pixelSegmentation[x + _this2.canvas.width * y];\n          }\n\n          _this2.props.onSelected(selectedBox.index);\n          _this2.setState({ hoverIndex: selectedBox.index });\n        };\n\n        _this2.canvas.onmouseout = function () {\n          _this2.props.onSelected(-1);\n          _this2.setState({ hoverIndex: -1 });\n          // this.renderBoxes();\n        };\n\n        _this2.canvas.addEventListener('click', function (event) {\n          _this2.props.onClicked(_this2.state.hoverIndex);\n        }, false);\n      };\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      var _this3 = this;\n\n      var ctx = this.canvas.getContext('2d');\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n      var background = new Image();\n      background.src = nextProps.options.base64Image ? 'data:image/png;base64,' + this.props.image : nextProps.image;\n\n      // Check canvas dimension with loaded image dimension\n      // in order to change canvas dimension if needed\n      background.onload = function () {\n\n        if (_this3.canvas.width !== background.width && _this3.canvas.height !== background.height) {\n          _this3.canvas.width = background.width;\n          _this3.canvas.height = background.height;\n          ctx.drawImage(background, 0, 0);\n          _this3.renderBoxes(nextProps.boxes);\n        }\n      };\n\n      ctx.drawImage(background, 0, 0);\n      this.renderBoxes(nextProps.boxes);\n\n      this.setState({ hoverIndex: nextProps.selectedIndex });\n\n      var hasSegmentedProps = nextProps.pixelSegmentation && nextProps.pixelSegmentation.length > 0;\n\n      if (hasSegmentedProps) {\n        this.setState({ isSegmented: false });\n        this.renderSegmentation(nextProps.pixelSegmentation);\n      }\n\n      return true;\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      this.renderBoxes();\n    }\n  }, {\n    key: 'segmentColor',\n    value: function segmentColor(classIndex) {\n\n      var segmentColors = this.state.segmentColors;\n\n      if (segmentColors[classIndex] && segmentColors[classIndex].length === 3) {\n        return segmentColors[classIndex];\n      }\n\n      var r = void 0;\n      var g = void 0;\n      var b = void 0;\n\n      if (this.props.segmentationColors && this.props.segmentationColors[classIndex]) {\n        var hex = this.props.segmentationColors[classIndex];\n        var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        r = parseInt(result[1], 16);\n        g = parseInt(result[2], 16);\n        b = parseInt(result[3], 16);\n      } else {\n        var random = (0, _seedrandom2.default)(classIndex);\n        r = Math.floor(random() * 255);\n        g = Math.floor(random() * 255);\n        b = Math.floor(random() * 255);\n      }\n\n      segmentColors[classIndex] = [r, g, b];\n      this.setState({ segmentColors: segmentColors });\n\n      return [r, g, b];\n    }\n  }, {\n    key: 'renderBox',\n    value: function renderBox(box, index) {\n\n      if (!box || typeof box === 'undefined') return null;\n\n      var color = this.props.options.colors.normal;\n      if (this.state.hoverIndex >= 0) {\n        color = this.props.options.colors.unselected;\n      }\n      if (index === this.state.hoverIndex) {\n        color = this.props.options.colors.selected;\n      }\n\n      var lineWidth = 2;\n      if (this.canvas.width > 600) {\n        lineWidth = 3;\n      }\n      if (this.canvas.width > 1000) {\n        lineWidth = 5;\n      }\n\n      this.props.drawBox(this.canvas, box, color, lineWidth);\n      if (box.label) {\n        this.props.drawLabel(this.canvas, box);\n      };\n    }\n  }, {\n    key: 'renderBoxes',\n    value: function renderBoxes(boxes) {\n      var _this4 = this;\n\n      if (typeof boxes === 'undefined') boxes = this.props.boxes;\n\n      if (this.props.boxes && this.props.boxes.length > 0) {\n\n        this.props.boxes.map(function (box, index) {\n          var selected = index === _this4.state.hoverIndex;\n          return { box: box, index: index, selected: selected };\n        }).sort(function (a) {\n          return a.selected ? 1 : -1;\n        }).forEach(function (box) {\n          return _this4.renderBox(box.box, box.index);\n        });\n      }\n    }\n  }, {\n    key: 'renderSegmentation',\n    value: function renderSegmentation(segmentation) {\n\n      var ctx = null;\n      var imgd = null;\n\n      if (this.props.separateSegmentation && this.segCanvas) {\n\n        this.segCanvas.width = this.canvas.width;\n        this.segCanvas.height = this.canvas.height;\n        ctx = this.segCanvas.getContext('2d');\n        imgd = ctx.getImageData(0, 0, this.segCanvas.width, this.segCanvas.height);\n        var pix = imgd.data;\n\n        for (var i = 0, j = 0, n = pix.length; i < n; i += 4, j += 1) {\n          var segmentClass = segmentation[j];\n          var segmentColor = this.segmentColor(segmentClass);\n          pix[i] = segmentColor[0];\n          pix[i + 1] = segmentColor[1];\n          pix[i + 2] = segmentColor[2];\n          pix[i + 3] = 255;\n        }\n      } else {\n\n        ctx = this.canvas.getContext('2d');\n        imgd = ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n        var _pix = imgd.data;\n\n        for (var i = 0, j = 0, n = _pix.length; i < n; i += 4, j += 1) {\n          var _segmentClass = segmentation[j];\n          var _segmentColor = this.segmentColor(_segmentClass);\n          _pix[i] = Math.round((_pix[i] + _segmentColor[0]) / 2);\n          _pix[i + 1] = Math.round((_pix[i + 1] + _segmentColor[1]) / 2);\n          _pix[i + 2] = Math.round((_pix[i + 2] + _segmentColor[2]) / 2);\n          _pix[i + 3] = 200;\n        }\n      }\n\n      ctx.putImageData(imgd, 0, 0);\n      this.setState({ isSegmented: true });\n    }\n  }, {\n    key: 'renderSegmentationMasks',\n    value: function renderSegmentationMasks() {\n      var _this5 = this;\n\n      var _props = this.props,\n          boxes = _props.boxes,\n          segmentationMasks = _props.segmentationMasks,\n          segmentationTransparency = _props.segmentationTransparency;\n\n\n      this.segCanvas.width = this.canvas.width;\n      this.segCanvas.height = this.canvas.height;\n      var ctx = this.segCanvas.getContext('2d');\n\n      segmentationMasks.forEach(function (mask, index) {\n\n        // Fetch segment color,\n        // using box label or current mask index\n        var segmentColor = _this5.segmentColor(boxes[index].label ? boxes[index].label : index);\n\n        // Fetch image data\n        // using the box coordinates\n        // and the mask dimensions\n        var maskData = ctx.getImageData(parseInt(boxes[index].xmin, 10), parseInt(boxes[index].ymin, 10), mask.width, mask.height);\n\n        // Fill image data with new mask color\n        for (var i = 0, j = 0; i < maskData.data.length; j++, i += 4) {\n          if (mask.data[j] > 0) {\n            maskData.data[i] = segmentColor[0];\n            maskData.data[i + 1] = segmentColor[1];\n            maskData.data[i + 2] = segmentColor[2];\n            maskData.data[i + 3] = segmentationTransparency;\n          }\n        }\n\n        // Put new mask data on displayed canvas\n        ctx.putImageData(maskData, parseInt(boxes[index].xmin, 10), parseInt(boxes[index].ymin, 10), 0, 0, mask.width, mask.height);\n      });\n\n      this.setState({ isSegmented: true });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this6 = this;\n\n      return _react2.default.createElement(\n        'div',\n        { className: this.props.className },\n        _react2.default.createElement('canvas', {\n          className: 'boundingBoxCanvas',\n          style: this.props.options.style,\n          ref: function ref(canvas) {\n            _this6.canvas = canvas;\n          }\n        }),\n        this.props.separateSegmentation ? _react2.default.createElement('canvas', {\n          className: 'boundingSegmentationCanvas',\n          style: this.props.options.style,\n          ref: function ref(canvas) {\n            _this6.segCanvas = canvas;\n          }\n        }) : null\n      );\n    }\n  }]);\n  return Boundingbox;\n}(_react.Component); /* global Image */\n\nBoundingbox.propTypes = {\n  image: _propTypes2.default.string,\n  boxes: _propTypes2.default.oneOfType([_propTypes2.default.arrayOf(_propTypes2.default.array), _propTypes2.default.arrayOf(_propTypes2.default.object)]),\n  separateSegmentation: _propTypes2.default.bool,\n  segmentationJsonUrl: _propTypes2.default.string,\n  segmentationColors: _propTypes2.default.array,\n  segmentationMasks: _propTypes2.default.array,\n  segmentationTransparency: _propTypes2.default.number,\n  selectedIndex: _propTypes2.default.number,\n  drawBox: _propTypes2.default.func,\n  drawLabel: _propTypes2.default.func,\n  onSelected: _propTypes2.default.func,\n  onClicked: _propTypes2.default.func,\n  options: _propTypes2.default.shape({\n    colors: _propTypes2.default.shape({\n      normal: _propTypes2.default.string,\n      selected: _propTypes2.default.string,\n      unselected: _propTypes2.default.string\n    }),\n    style: _propTypes2.default.object,\n    base64Image: _propTypes2.default.bool\n  })\n};\n\nBoundingbox.defaultProps = {\n\n  separateSegmentation: false,\n  segmentationTransparency: 190,\n  onSelected: function onSelected() {},\n  onClicked: function onClicked() {},\n  drawBox: function drawBox(canvas, box, color, lineWidth) {\n\n    if (!box || typeof box === 'undefined') return null;\n\n    var ctx = canvas.getContext('2d');\n\n    var coord = box.coord ? box.coord : box;\n\n    var x = 0,\n        y = 0,\n        width = 0,\n        height = 0;\n\n\n    if (typeof coord.xmin !== 'undefined' && typeof coord.xmax !== 'undefined' && typeof coord.ymin !== 'undefined' && typeof coord.ymax !== 'undefined') {\n      var _ref2 = [coord.xmin, coord.ymax, Math.abs(coord.xmax - coord.xmin), Math.abs(coord.ymax - coord.ymin)];\n\n      // coord is an object containing xmin, xmax, ymin, ymax attributes\n      // width is absolute value of (xmax - xmin)\n      // height is absolute value of (ymax - ymin)\n      // absolute value takes care of various possible referentials:\n      //   - sometimes 0,0 is top-left corner\n      //   - sometimes 0,0 is bottom-left corner\n\n      x = _ref2[0];\n      y = _ref2[1];\n      width = _ref2[2];\n      height = _ref2[3];\n    } else {\n      var _coord2 = (0, _slicedToArray3.default)(coord, 4);\n\n      // coord is an array containing [x, y, width, height] values\n\n\n      x = _coord2[0];\n      y = _coord2[1];\n      width = _coord2[2];\n      height = _coord2[3];\n    }\n\n    if (x < lineWidth / 2) {\n      x = lineWidth / 2;\n    }\n    if (y < lineWidth / 2) {\n      y = lineWidth / 2;\n    }\n\n    if (x + width > canvas.width) {\n      width = canvas.width - lineWidth - x;\n    }\n    if (y + height > canvas.height) {\n      height = canvas.height - lineWidth - y;\n    }\n\n    // Left segment\n    var tenPercent = width / 10;\n    var ninetyPercent = 9 * tenPercent;\n    ctx.strokeStyle = color;\n    ctx.lineWidth = lineWidth;\n    ctx.beginPath();\n    ctx.moveTo(x + tenPercent, y);\n    ctx.lineTo(x, y);\n    ctx.lineTo(x, y + height);\n    ctx.lineTo(x + tenPercent, y + height);\n    ctx.stroke();\n\n    // Right segment\n    ctx.beginPath();\n    ctx.moveTo(x + ninetyPercent, y);\n    ctx.lineTo(x + width, y);\n    ctx.lineTo(x + width, y + height);\n    ctx.lineTo(x + ninetyPercent, y + height);\n    ctx.stroke();\n  },\n  drawLabel: function drawLabel(canvas, box) {\n\n    if (!box || typeof box === 'undefined') return null;\n\n    var ctx = canvas.getContext('2d');\n\n    var coord = box.coord ? box.coord : box;\n\n    var x = 0,\n        y = 0,\n        width = 0,\n        height = 0;\n\n\n    if (typeof coord.xmin !== 'undefined' && typeof coord.xmax !== 'undefined' && typeof coord.ymin !== 'undefined' && typeof coord.ymax !== 'undefined') {\n      var _ref3 = [coord.xmin, coord.ymax, Math.abs(coord.xmax - coord.xmin), Math.abs(coord.ymax - coord.ymin)];\n\n      // coord is an object containing xmin, xmax, ymin, ymax attributes\n      // width is absolute value of (xmax - xmin)\n      // height is absolute value of (ymax - ymin)\n      // absolute value takes care of various possible referentials:\n      //   - sometimes 0,0 is top-left corner\n      //   - sometimes 0,0 is bottom-left corner\n\n      x = _ref3[0];\n      y = _ref3[1];\n      width = _ref3[2];\n      height = _ref3[3];\n    } else {\n      var _coord3 = (0, _slicedToArray3.default)(coord, 4);\n\n      // coord is an array containing [x, y, width, height] values\n\n\n      x = _coord3[0];\n      y = _coord3[1];\n      width = _coord3[2];\n      height = _coord3[3];\n    }\n\n    ctx.font = '60px Arial';\n    ctx.fillStyle = 'rgba(225,0,0,1)';\n    ctx.fillText(box.label, x, y + height);\n  },\n\n  options: {\n    colors: {\n      normal: 'rgba(255,225,255,1)',\n      selected: 'rgba(0,225,204,1)',\n      unselected: 'rgba(100,100,100,1)'\n    },\n    style: {\n      maxWidth: '100%',\n      maxHeight: '90vh'\n    },\n    base64Image: false\n  }\n};\n\nexports.default = Boundingbox;\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}